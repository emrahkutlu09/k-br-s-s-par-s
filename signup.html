<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>KayÄ±t Ol</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <style>
    body { font-family: Arial; background: #f4f4f4; padding: 30px; }
    form { background: white; padding: 20px; border-radius: 8px; max-width: 400px; margin: auto; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    input { display: block; width: 100%; margin-bottom: 10px; padding: 8px; border-radius: 4px; border: 1px solid #ccc; }
    button { padding: 10px 15px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer; }
    button:hover { background: #218838; }
    .google-btn {
      background: #dd4b39;
      margin-top: 15px;
    }
    .google-btn:hover {
      background: #c23321;
    }
  </style>
</head>
<body>
  <h2 style="text-align:center;">KayÄ±t Ol</h2>
  <form id="kayitFormu">
    <input type="text" id="adSoyad" placeholder="Ad Soyad" required>
    <input type="email" id="email" placeholder="E-posta" required>
    <input type="password" id="sifre" placeholder="Åžifre" required>
    <input type="tel" id="telefon" placeholder="Telefon NumarasÄ±" required>
    <input type="text" id="adres" placeholder="Adres" required>
    <button type="submit">E-posta ile KayÄ±t Ol</button>
  </form>

  <button class="google-btn" onclick="googleIleKayit()">ðŸ”’ Google ile KayÄ±t Ol</button>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBCbKtD6jPE653IYwtTWo2fH93JXX4MN74",
      authDomain: "kibrissiparissistemi.firebaseapp.com",
      projectId: "kibrissiparissistemi",
      storageBucket: "kibrissiparissistemi.appspot.com",
      messagingSenderId: "263531733235",
      appId: "1:263531733235:web:82efdf39ed758a22465786"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    document.getElementById("kayitFormu").addEventListener("submit", async function(e) {
      e.preventDefault();

      const adSoyad = document.getElementById("adSoyad").value;
      const email = document.getElementById("email").value;
      const sifre = document.getElementById("sifre").value;
      const telefon = document.getElementById("telefon").value;
      const adres = document.getElementById("adres").value;

      try {
        const sonuc = await auth.createUserWithEmailAndPassword(email, sifre);
        const kullanici = sonuc.user;

        await db.collection("uyeler").doc(kullanici.uid).set({
          adSoyad,
          email,
          telefon,
          adres,
          kayitTarihi: new Date()
        });

        alert("KayÄ±t baÅŸarÄ±lÄ±!");
        window.location.href = "confirm.html";
      } catch (error) {
        if (error.code === "auth/email-already-in-use") {
          alert("Bu e-posta zaten kayÄ±tlÄ±. LÃ¼tfen giriÅŸ yapÄ±n.");
        } else {
          alert("Hata: " + error.message);
        }
      }
    });

    async function googleIleKayit() {
      const provider = new firebase.auth.GoogleAuthProvider();
      try {
        const sonuc = await auth.signInWithPopup(provider);
        const kullanici = sonuc.user;

        // Firestore'da zaten kayÄ±tlÄ± deÄŸilse ekle
        const docRef = db.collection("uyeler").doc(kullanici.uid);
        const doc = await docRef.get();

        if (!doc.exists) {
          await docRef.set({
            adSoyad: kullanici.displayName || "",
            email: kullanici.email,
            telefon: "",
            adres: "",
            kayitTarihi: new Date()
          });
        }

        alert("Google ile kayÄ±t baÅŸarÄ±lÄ±!");
        window.location.href = "confirm.html";
      } catch (error) {
        alert("Google ile kayÄ±t baÅŸarÄ±sÄ±z: " + error.message);
      }
    }
  </script>
</body>
</html>
